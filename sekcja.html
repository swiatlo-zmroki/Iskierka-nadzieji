<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>≈Åadowanie...</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #1a1a1a; color: #f0f0f0; }
        .back-link { display: inline-block; margin: 20px; color: #ffcc00; font-weight: bold; text-decoration: none; font-size: 1.2em; }
        .content-container { max-width: 900px; margin: 20px auto; padding: 20px; }
        .section-title { text-align: center; font-size: 2.5em; border-bottom: 2px solid #d32f2f; padding-bottom: 10px; margin-bottom: 30px; }
        .entry { background: #2a2a2a; border: 1px solid #444; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
        .entry-title { font-size: 1.8em; margin-top: 0; color: #ffcc00; }
        .entry-author { font-style: italic; color: #ccc; margin-bottom: 15px; }
        .entry-content { line-height: 1.7; font-size: 1.1em; }
        .speak-button { padding: 8px 15px; font-size: 1em; font-weight: bold; border: none; border-radius: 20px; cursor: pointer; color: #fff; background-color: #28a745; margin-top: 15px; }
    </style>
</head>
<body>

    <a href="index.html" class="back-link">‚üµ Wr√≥ƒá na stronƒô g≈Ç√≥wnƒÖ</a>

    <div class="content-container">
        <h1 id="sectionTitle" class="section-title">≈Åadowanie sekcji...</h1>
        <div id="entriesContainer">
            </div>
    </div>

    <script>
        // --- LEKTOR ---
        function createLector(button, textToRead) {
            let isReading = false;
            let currentIndex = 0;
            const sentences = textToRead.match(/[^.!?‚Ä¶]+[.!?‚Ä¶]?/g) || [textToRead];

            button.addEventListener('click', () => {
                if (isReading) {
                    isReading = false;
                    window.speechSynthesis.cancel();
                    button.textContent = 'üîÑ Wzn√≥w';
                } else {
                    isReading = true;
                    button.textContent = '‚è∏Ô∏è Pauza';
                    readSentence(currentIndex);
                }
            });

            function readSentence(i) {
                if (!isReading || i >= sentences.length) {
                    isReading = false;
                    currentIndex = 0;
                    button.textContent = '‚ñ∂Ô∏è Ods≈Çuchaj';
                    return;
                }
                const utterance = new SpeechSynthesisUtterance(sentences[i].trim());
                utterance.lang = "pl-PL";
                utterance.onend = () => {
                    if (isReading) {
                        currentIndex++;
                        readSentence(currentIndex);
                    }
                };
                window.speechSynthesis.speak(utterance);
            }
        }

        // --- G≈Å√ìWNA LOGIKA STRONY ---
        window.addEventListener('load', async () => {
            const sectionTitleElement = document.getElementById('sectionTitle');
            const entriesContainer = document.getElementById('entriesContainer');
            
            try {
                // Odczytujemy nazwƒô sekcji z adresu URL (np. sekcja.html?nazwa=kronika)
                const params = new URLSearchParams(window.location.search);
                const sectionSlug = params.get('nazwa');

                if (!sectionSlug) {
                    throw new Error("Nie podano nazwy sekcji.");
                }
                
                // Zmieniamy tytu≈Ç strony
                const sectionName = sectionSlug.charAt(0).toUpperCase() + sectionSlug.slice(1);
                document.title = sectionName + " ‚Äì Od Dna do ≈öwiat≈Ça";
                sectionTitleElement.textContent = sectionName;

                // Pytamy naszego "pomocnika" o wpisy dla tej sekcji
                const response = await fetch(`/api/entries?section=${sectionSlug}`);
                if (!response.ok) throw new Error('B≈ÇƒÖd ≈Çadowania danych z serwera.');
                
                const entries = await response.json();

                if (entries.length === 0) {
                    entriesContainer.innerHTML = '<p>Brak wpis√≥w w tej sekcji. Dodaj pierwszy wpis w panelu admina!</p>';
                    return;
                }

                // Budujemy HTML dla ka≈ºdego wpisu
                entriesContainer.innerHTML = '';
                entries.forEach((entry, index) => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'entry';

                    let authorHtml = entry.author ? `<p class="entry-author">Autor: ${entry.author}</p>` : '';
                    
                    entryElement.innerHTML = `
                        <h2 class="entry-title">${entry.title}</h2>
                        ${authorHtml}
                        <div class="entry-content" id="content-${index}">${entry.content.replace(/\n/g, '<br>')}</div>
                        <button class="speak-button" id="speakBtn-${index}">‚ñ∂Ô∏è Ods≈Çuchaj</button>
                    `;
                    
                    entriesContainer.appendChild(entryElement);
                    
                    // Pod≈ÇƒÖczamy lektora do nowo stworzonego wpisu
                    const speakButton = document.getElementById(`speakBtn-${index}`);
                    const contentDiv = document.getElementById(`content-${index}`);
                    createLector(speakButton, contentDiv.innerText);
                });

            } catch (error) {
                sectionTitleElement.textContent = "B≈ÇƒÖd";
                entriesContainer.innerHTML = `<p style="color:red;">WystƒÖpi≈Ç b≈ÇƒÖd: ${error.message}</p>`;
            }
        });
    </script>

</body>
</html>
